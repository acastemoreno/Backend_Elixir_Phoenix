<!DOCTYPE html>
<html>
<head>
<title></title>
<!-- 2016-10-29 sáb 11:53 -->
<meta  charset="utf-8" />
<meta  htto-equiv="X-UA-Compatible" content="chrome=1" />
<meta  name="generator" content="Org-mode with org-ioslide" />
<meta  name="author" content="Albert Castellano Moreno" />


<!--<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">-->
<!--<meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--This one seems to work all the time, but really small on ipad-->
<!--<meta name="viewport" content="initial-scale=0.4">-->
<meta name="apple-mobile-web-app-capable" content="yes" />
<link rel="stylesheet" media="all" href="theme/css/default.css" />
<link rel="stylesheet" media="only screen and (max-device-width: 480px)" href="theme/css/phone.css" />
<link rel="stylesheet" media="all" href="theme/css/small-icon.css" />
<base target="_blank"> <!-- This amazingness opens all links in a new tab. -->
<script data-main="js/slides" src="js/require-1.0.8.min.js"></script>

   <script src="js/jquery-1.7.1.min.js" type="text/javascript"></script>

<script src="js/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML,local/local" type="text/javascript"></script>
</head>
<body style="opacity: 0">
<slides class="layout-widescreen">
<slide class="title-slide segue nobackground">
       <aside class="gdbar"><img src="images/phoenix.svg"></aside>
       <!-- The content of this hgroup is replaced programmatically through the slide_config.json. -->
       <hgroup class="auto-fadein">
         <h1 data-config-title><!-- populated from slide_config.json --></h1>
         <h2 data-config-subtitle><!-- populated from slide_config.json --></h2>
         <p data-config-presenter><!-- populated from slide_config.json --></p>
       </hgroup>
    </slide>
  <slide id="sec-" class="fill white nobackground" style="background-image: url(images/phoenix.gif)">
<hgroup class="">
       <h2 class="white "><div id="outline-container-orgheadline1" class="outline-2">
<h2 id="orgheadline1"></h2>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">


</article>

</slide>
</slide>
<slide id="sec-" class=" segue dark quote nobackground" style="background-image: url(nil)">
<aside class="gdbar right bottom"><img src="images/phoenix.svg"></aside><hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline3" class="outline-2">
<h2 id="orgheadline3">Contenido</h2>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="flexbox vleft auto-fadein" id="text-">


</article>

</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline2" class="outline-3">
<h3 id="orgheadline2">Contenido</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">
<ul>
<li>Authentication</li>
<li>Authorization</li>
</ul>


</article>

</slide>

</slide>

</slide>
<slide id="sec-" class=" segue dark quote nobackground" style="background-image: url(nil)">
<aside class="gdbar right bottom"><img src="images/phoenix.svg"></aside><hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline19" class="outline-2">
<h2 id="orgheadline19">Authentication</h2>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="flexbox vleft auto-fadein" id="text-">


</article>
</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline4" class="outline-3">
<h3 id="orgheadline4">Qué es Authentication?</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">
<p>
Es el proceso por el cual el usuario se identifica ante la aplicación.
</p>

<p>
Para este proceso usaremos la siguiente libreria <a href="https://github.com/ueberauth/ueberauth">Ueberauth</a>, que es un sistema de autenticacion basado en plug
</p>


</article>

</slide>
</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline5" class="outline-3">
<h3 id="orgheadline5">Conceptos de Ueberauth</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">
<ul>
<li>Strategies: Son <code>plugs</code> que decoran o interceptan (o ambos) requests. Las estrategias implementan 2 fases.</li>
<li>Request Phase: Es la fase donde se solicita información sobre el usuario. Esto puede suceder mediante una redireccion a un sistema OAuth2(Facebook, Twitter, github, &#x2026;) o un formulario.</li>
<li>Callback Phase: Esta fase es donde ocurre la magia. Una vez que el <code>request phase</code> ha sido completado, el <code>provider</code> (facebook, twitter, github, &#x2026;) llamara a un url Callback enviando la información del usuario.</li>
</ul>


</article>

</slide>
</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline6" class="outline-3">
<h3 id="orgheadline6">Avancemos un poco</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="smaller" id="text-">
<ul>
<li>Creamos un proyecto, con el siguiente comando: <code>mix phoenix.new septima</code></li>
<li>Ingresamos a pgadmin, creamos un usuario con contraseña y solo con los privilegios para loguearse y para crear base de datos. (En mi caso sera usuario: septima<sub>dev</sub>, contraseña: 123456789)</li>
<li>Ingresamos a <code>septima/config/dev.exs</code> y configuramos ecto con el usuario y contraseña creados.</li>
<li>Creamos una base de datos con <code>mix ecto.create</code></li>
</ul>
<p>
Basicamente pasos basicos para no tener problemas con mensaje de error por conexion a base de datos.
</p>


</article>

</slide>
</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline7" class="outline-3">
<h3 id="orgheadline7"></h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">
<p>
Ahora teniendo una cuenta github entramos al siguiente <a href="https://github.com/settings/developers">link</a> para registrar nuestra aplicación ante github.
Es importante que los campos para <code>Homepage URL</code> y <code>Authorization callback URL</code> sean igual a la imagen. Se explicara más adelante la razón.
</p>
<article class="flexbox vcenter">

<div class="figure">
<p><img src="images/github_app_OAuth.png" alt="github_app_OAuth.png" width="400px" />
</p>
</div>
</article>


</article>

</slide>
</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline8" class="outline-3">
<h3 id="orgheadline8"></h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="smaller" id="text-">
<p>
Una vez registrada nuestra aplicación ante gihub, tomaremos nota de la siguiente información sensible <code>Client ID</code> y <code>Client Secret</code>
</p>
<article class="flexbox vcenter">

<div class="figure">
<p><img src="images/datos_github.png" alt="datos_github.png" width="400px" />
</p>
</div>
</article>
<p>
Es importante que esta información sea bien guardada por motivos de seguridad.
</p>


</article>

</slide>
</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline9" class="outline-3">
<h3 id="orgheadline9"></h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="smaller" id="text-">
<ul>
<li>Ahora agregamos <code>ueberauth</code> a nuestra dependencias en <code>mix.exs</code>:</li>
</ul>
<div class="org-src-container">

<pre class="prettyprint" data-lang="elixir">
def deps do
  [<b>{:ueberauth_github, "~&gt; 0.4"}</b>]
end
</pre>

</div>
<ul>
<li>Registramos la estrategia <code>github</code> como aplicación en <code>mix.exs</code>:</li>
</ul>
<div class="org-src-container">

<pre class="prettyprint" data-lang="elixir">
def application do
  [applications: [<b>:ueberauth_github</b>]]
end
</pre>

</div>
<ul>
<li>Al hacer lo anterior la dependencia y aplicacion <code>ueberauth</code> tambien ha sido registrada (forma parte de las librerias y aplicaciones de <code>ueberauth_github</code>). Dicho esto necesitamos configurar <code>ueberauth</code> agregando el siguiente codigo a <code>/config/config.exs</code></li>
</ul>
<div class="org-src-container">

<pre class="prettyprint" data-lang="elixir">
config :ueberauth, Ueberauth,
  providers: [
    github: {Ueberauth.Strategy.Github, []}
  ]
</pre>

</div>


</article>

</slide>
</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline10" class="outline-3">
<h3 id="orgheadline10"></h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="smaller" id="text-">
<ul>
<li>al final del archivo <code>config/dev.exs</code> agregamos el siguiente codigo:</li>
</ul>
<div class="org-src-container">

<pre class="prettyprint" data-lang="elixir">
import_config "dev.secret.exs"
</pre>

</div>
<ul>
<li>creamos el archivo <code>config/dev.secret.exs</code> con el siguiente codigo reemplazando los valores correspondientes a <code>cliente_id</code> y <code>client_secret</code>:</li>
</ul>
<div class="org-src-container">

<pre class="prettyprint" data-lang="elixir">
use Mix.Config

config :ueberauth, Ueberauth.Strategy.Github.OAuth,
  client_id: "holi, soy un texto que representa el cliente_id, reemplazame :v",
  client_secret: "holi, soy un texto que representa el client_secret, reemplazame :v"
</pre>

</div>
<ul>
<li>finalmente modificamos el archivo <code>.gitignore</code> añadiendo la siguiente linea al final:</li>
</ul>
<div class="org-src-container">

<pre class="prettyprint" data-lang="elixir">
...
/config/prod.secret.exs
<b>/config/dev.secret.exs</b>
</pre>

</div>
<p>
Todo esto para asegurarnos de que no subamos por accidente información sensible a github.
</p>


</article>

</slide>
</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline11" class="outline-3">
<h3 id="orgheadline11"></h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="smaller" id="text-">
<ul>
<li>Modificamos <code>web/router.exs</code> de la siguiente manera:</li>
</ul>
<div class="org-src-container">

<pre class="prettyprint" data-lang="elixir">
defmodule Septima.Router do
  use Septima.Web, :router

  ...

  scope "/", Septima do
    pipe_through :browser # Use the default browser stack

    get "/", PageController, :index
  end

  <b>scope "/auth", Septima do
    pipe_through :browser

    get "/:provider", AuthController, :request
    get "/:provider/callback", AuthController, :callback
  end</b>
  # Other scopes may use custom stacks.
  # scope "/api", Septima do
  #   pipe_through :api
  # end
end
</pre>

</div>


</article>

</slide>
</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline12" class="outline-3">
<h3 id="orgheadline12"></h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="smaller" id="text-">
<p>
Creamos un archivo <code>web/controllers/auth_controller.ex</code>
</p>
<div class="org-src-container">

<pre class="prettyprint" data-lang="elixir">
defmodule Septima.AuthController do
  use Septima.Web, :controller
  plug Ueberauth

  def request(conn, _params) do
    text conn, "Holi, no debo aparecer"
  end

  def callback(%{assigns: %{ueberauth_failure: _fails}} = conn, _params) do
    conn
    |&gt; put_flash(:error, "Fallo en la authenticacion.")
    |&gt; redirect(to: "/")
  end

  def callback(%{assigns: %{ueberauth_auth: _auth}} = conn, _params) do
    text conn, "Holi, el callback recibio mi información"
  end
end
</pre>

</div>


</article>

</slide>
</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline13" class="outline-3">
<h3 id="orgheadline13">Finalmente &lt;3</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">
<ul>
<li>Reemplazamos el contenido del archivo <code>web/templates/page/index.html.eex</code> por el siguiente codigo:</li>
</ul>
<div class="org-src-container">

<pre class="prettyprint" data-lang="elixir">
&lt;div class="jumbotron"&gt;
  &lt;h2&gt;Login por Ueberauth&lt;/h2&gt;
  &lt;p class="lead"&gt;&lt;%= link "Login with Github", to: auth_path(@conn, :request, "github")
  , class: "btn btn-success text-center" %&gt;&lt;/p&gt;
&lt;/div&gt;
</pre>

</div>
<ul>
<li>Ejecutamos <code>mix deps.get</code></li>
<li>Ejecutamos <code>mix compile</code></li>
<li>Ejecutamos <code>mix phoenix.server</code></li>
</ul>


</article>

</slide>
</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline14" class="outline-3">
<h3 id="orgheadline14">Resultado</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">
<article class="flexbox vcenter">

<div class="figure">
<p><img src="images/github1.png" alt="github1.png" width="700px" />
</p>
</div>
</article>


</article>

</slide>
</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline15" class="outline-3">
<h3 id="orgheadline15"></h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">
<article class="flexbox vcenter">

<div class="figure">
<p><img src="images/github2.png" alt="github2.png" width="700px" />
</p>
</div>
</article>


</article>

</slide>
</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline16" class="outline-3">
<h3 id="orgheadline16"></h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">
<article class="flexbox vcenter">

<div class="figure">
<p><img src="images/github3.png" alt="github3.png" width="900px" />
</p>
</div>
</article>


</article>

</slide>
</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline17" class="outline-3">
<h3 id="orgheadline17">Lets work with databases</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="smaller" id="text-">
<ul>
<li>Ejecutamos <code>mix phoenix.gen.model User users nombre:string email:string is_admin:boolean</code></li>
<li>Ejecutamos <code>mix phoenix.gen.model Authorization authorizations provider:string uid:string token:string refresh_token:string expired_at:integer  user_id:references:users</code></li>
<li>Ejecutamos las migraciones con <code>mix ecto.migrate</code></li>
<li>Modificamos el archivo <code>/models/user.ex</code>:</li>
</ul>
<div class="org-src-container">

<pre class="prettyprint" data-lang="elixir">
schema "users" do
  ...

  <b>has_many :authorizations, Septima.Authorization</b>

  timestamps
end
</pre>

</div>


</article>

</slide>
</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline18" class="outline-3">
<h3 id="orgheadline18"></h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="smaller" id="text-">
<ul>
<li>Modificamos el archivo <code>/models/user.ex</code> (quitamos <code>:refresh_token</code> y <code>:expires_at</code> de la funcion <code>validate_required</code>):</li>
</ul>
<div class="org-src-container">

<pre class="prettyprint" data-lang="elixir">
schema "authorizations" do
  ...
  field :expires_at, :integer
  <b>field :password, :string, virtual: true
  field :password_confirmation, :string, virtual: true</b>

  belongs_to :user, Septima.User

  timestamps
end

@doc """
Builds a changeset based on the `struct` and `params`.
"""
def changeset(struct, params \\ %{}) do
  struct
  |&gt; cast(params, [:provider, :uid, :token, :refresh_token, :expired_at])
  |&gt; validate_required([:provider, :uid, :token])
end
</pre>

</div>


</article>

</slide>

</slide>


</slide>
<slide id="sec-" class=" thank-you-slide segue nobackground" style="background-image: url(nil)">
<aside class="gdbar right"><img src="images/phoenix.svg"></aside><article class="flexbox vleft auto-fadein" id="text-">
<h2>
  <p>Gracias ˊ・ω・ˋ</p>
</h2>
<br>
<p class="auto-fadein" data-config-contact>
</p>
</article>

</slide>
<slide class="backdrop"></slide>
</slides> 
<!--[if IE]>
  <script src="http://ajax.googleapis.com/ajax/libs/chrome-frame/1/CFInstall.min.js"></script>
  <script>CFInstall.check({mode: 'overlay'});</script>
<![endif]-->
</body> 

</html>
